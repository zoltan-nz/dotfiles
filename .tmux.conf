# cat << ►_◄ > /dev/null

#####################
#        C-A        #
#####################

# remap prefix to C-a
set -g prefix C-a
unbind C-b
bind a send-prefix # <C-a a> jump to the first character in command line

# quick pane cycling with double C-a
unbind C-a
bind C-a select-pane -t :.+

#####################
#      EDITOR       #
#####################

# force a reload of the config file
unbind r
bind r source-file ~/.tmux.conf

# C-a + e for editing tmux.conf
bind e new-window -n '~/.tmux.conf' "sh -c 'vim ~/.tmux.conf'"

#####################
#      OPTIONS      #
#####################

# SERVER
set -sg default-terminal "screen-256color"
set -sg escape-time 0           # faster command sequences, no delay for escape key press
set -sg repeat-time 600         # increase repeat timeout
set -sg history-limit 5000
set -sg base-index 1
set -sg renumber-windows on     # renumber windows when a window is closed
set -sg set-titles on           # set terminal title
set -sg set-titles-string '#h ❐ #S ● #I #W'
set -sg display-panes-time 800  # slightly longer pane indicators display time
set -sg display-time 1000       # slightly longer status messages display time
set -sg status-interval 10      # redraw status line every 10 seconds
set -sg mouse on
set -sg visual-activity on
set -sg detach-on-destroy off
set -ga terminal-overrides ',*:Ss=\E[%p1%d q:Se=\E[2 q' # Fix cursor shape changes
set -g update-environment "DBUS_SESSION_BUS_ADDRESS"

# WINDOW
setw -g xterm-keys on       # for vim
setw -g pane-base-index 1
setw -g automatic-rename on # rename to current program
setw -g clock-mode-style 24 # 24 hour clock
setw -g mode-keys vi        # use vi commands in copy mode
setw -g monitor-activity on

#####################
#      BINDING      #
#####################

# keep the current directory
bind '"' split-window -c "#{pane_current_path}"
bind % split-window -h -c "#{pane_current_path}"
bind c new-window -c "#{pane_current_path}"

# pane navigation
bind -r h select-pane -L  # move left
bind -r j select-pane -D  # move down
bind -r k select-pane -U  # move up
bind -r l select-pane -R  # move right
bind > swap-pane -D       # swap current pane with the next one
bind < swap-pane -U       # swap current pane with the previous one

# pane resizing
bind -r H resize-pane -L 2
bind -r J resize-pane -D 2
bind -r K resize-pane -U 2
bind -r L resize-pane -R 2

# window navigation
bind -r C-b previous-window # select previous window
bind -r C-n next-window     # select next window
bind Tab last-window        # move to last active window

bind Escape copy-mode # Escape copy mode
bind enter copy-mode  # enter copy mode
bind b list-buffers   # list paster buffers
bind p paste-buffer   # paste from the top pate buffer
bind p choose-buffer  # choose which buffer to paste from

bind -t vi-copy v begin-selection
bind -t vi-copy C-v rectangle-toggle
bind -t vi-copy y copy-selection
bind -t vi-copy Escape cancel
bind -t vi-copy H start-of-line
bind -t vi-copy L end-of-line

# Fix to allow mousewheel/trackpad scrolling in tmux 2.1
bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "select-pane -t =; copy-mode -e; send-keys -M"
bind -n WheelDownPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "select-pane -t =; send-keys -M"

# Smart pane switching with awareness of Vim splits.
# See: https://github.com/christoomey/vim-tmux-navigator
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
        | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
        bind -n C-h if-shell "$is_vim" "send-keys C-h"  "select-pane -L"
        bind -n C-j if-shell "$is_vim" "send-keys C-j"  "select-pane -D"
        bind -n C-k if-shell "$is_vim" "send-keys C-k"  "select-pane -U"
        bind -n C-l if-shell "$is_vim" "send-keys C-l"  "select-pane -R"
        bind -n C-\ if-shell "$is_vim" "send-keys C-\\" "select-pane -l"

# Clear screen
bind C-l send-keys 'C-l'

# Create a new session and prompt for a name
bind C-c new-session 'new-session -s %%'

# Mouse
bind m run "cat ~/.tmux.util | sh -s toggle_mouse"
# Urlview
bind U run "cat ~/.tmux.util | sh -s urlview #{pane_id}"
#Facebook Pathpicker
bind F run "cat ~/.tmux.util | sh -s fpp #{pane_id}"

# Copy to Mac OSX pasteboard
if -b 'which -s reattach-to-user-namespace' 'bind y run "tmux save-buffer - | reattach-to-user-namespace pbcopy"'

tmux_conf_theme=default
tmux_conf_theme_prefix=enabled
tmux_conf_theme_battery=disabled
tmux_conf_new_session_prompt=true
tmux_conf_new_windows_retain_current_path=true
tmux_conf_new_panes_retain_current_path=true

run 'cat ~/.tmux.util | sh -s apply_configuration'
